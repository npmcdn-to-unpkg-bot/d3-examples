<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>client-side storage summary</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
      svg {
        background-color: #F8F8F8;
      }

      .node circle {
        fill: #fff;
        stroke-width:2px;
        stroke: teal;
      }

      .node text{
        font: 12px sans-serif;
      }

      .node-internal text {
        text-shadow: 0 1px 0 #fff,  0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
      }

      .link {
        fill: none;
        stroke: #ccc;
        stroke-width: 2px;
      }

    </style>
  </head>
  <body>
    <svg width="960" height="800"></svg>
    <script>
      var svg = d3.select("svg"),
          width = +svg.attr("width"),
          height = +svg.attr("height"),
          g = svg.append("g").attr("transform", "translate(120,0)"); // make all groups move toward to bottom right

      // declare tree layout with size
      var tree = d3.tree()
                   .size([height, width / 2]);

      d3.json("data/client-side-storage.json", function(error, root){
        if(error) throw error;

        // maps nodes data to tree layout
        var nodes = d3.hierarchy(root, function (d) {
          return d.children;
        });
        nodes = tree(nodes);

        var links = g.selectAll(".link")
                      .data(nodes.descendants().slice(1))
                        .enter().append("path")
                      .attr("class", "link")
                      .attr("d", function(d) {

                        return "M" + d.y + "," + d.x
                          + "C" + (d.parent.y + 100) + "," + d.x
                          + " " + (d.parent.y + 100) + "," + d.parent.x
                          + " " + d.parent.y + "," + d.parent.x;
                      });

        var node = g.selectAll(".node")
                      .data(nodes.descendants())
                    .enter().append("g")
                      .attr("class", function(d) {
                        return "node" + (d.children ? " node--internal" : " node--leaf"); })
                      .attr("transform" , function(d) {
                        return "translate(" + d.y +"," + d.x + ")"; })
                      .on("click", function(d) {console.log('clicked'); toggle(d); });

        node.append("circle")
          .attr("r", 8);

        node.append("text")
          .attr("dy", ".35em") // vertically aligning text relative to the absolute y coordinate
          .attr("x", function(d) { return d.children ? -12 : 12; }) // if has children, text will be on the left
          .style("text-anchor", function(d) {
            return d.children ? "end" : "start"; }) // set anchor y justification
          .text(function(d) {return d.data.name });


          // toggle the node to show/hide its children
          function toggle(d) {
            if(d.children) {
              d._children = d.children;
              d.children = null;
            } else {
              d.children = d._children;
              d._children = null;
            }
          }


      });

    </script>
  </body>
</html>
